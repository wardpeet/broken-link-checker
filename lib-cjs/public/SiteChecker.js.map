{"version":3,"file":"SiteChecker.js","names":["_events","require","_Link","_httpProtocol","_HtmlUrlChecker","_interopRequireDefault","_parseOptions","_limitedRequestQueue","_interopRequireWildcard","_SafeEventEmitter","_urlcache","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_classPrivateMethodInitSpec","_checkPrivateRedeclaration","add","_classPrivateFieldInitSpec","TypeError","_classPrivateFieldGet","s","_assertClassBrand","_classPrivateFieldSet","arguments","length","PAGE_EXCLUSIONS","PAGE_WAS_CHECKED","_currentAuth","_currentCustomData","_currentDone","_currentPageError","_currentRobotsTxt","_currentSiteURL","_htmlUrlChecker","_options","_sitePagesChecked","_siteUrlQueue","_SiteChecker_brand","WeakSet","SiteChecker","SafeEventEmitter","constructor","options","_overrideOptions","parseOptions","URLCache","maxAge","cacheMaxAge","_reset","RequestQueue","maxSockets","rateLimit","on","ITEM_EVENT","url","auth","customData","done","isHTTPScheme","honorRobotExclusions","robots","getRobotsTxt","__cache","emit","ROBOTS_EVENT","_enqueuePage","REQUEST_QUEUE_END_EVENT","END_EVENT","HtmlUrlChecker","ERROR_EVENT","error","HTML_EVENT","tree","response","pageURL","redirects","forEach","redirect","QUEUE_EVENT","JUNK_EVENT","result","_maybeEnqueuePage","LINK_EVENT","PAGE_EVENT","SITE_EVENT","clearCache","dequeue","id","success","enqueue","firstPageURL","transitive","transitiveAuth","isPaused","numActiveLinks","numQueuedLinks","numPages","numSites","pause","resume","exports","_getExcludedReason","link","IS_INTERNAL","_isAllowed","_link$get","rebasedPathname","REBASED_URL","pathname","isAllowed","userAgent","WAS_EXCLUDED","includes","EXCLUDED_REASON","tagGroup","tags","recursive","filterLevel","HTML_TAG_NAME","attrSupported","HTML_ATTR_NAME","rebasedURL","redirectedURL","REDIRECTED_URL","IS_BROKEN","HTTP_RESPONSE","includePage","includeLink","excludedReason","undefined","clear","module"],"sources":["../../lib/public/SiteChecker.js"],"sourcesContent":["import {END_EVENT, ERROR_EVENT, HTML_EVENT, JUNK_EVENT, LINK_EVENT, PAGE_EVENT, QUEUE_EVENT, ROBOTS_EVENT, SITE_EVENT} from \"../internal/events\";\nimport {EXCLUDED_REASON, HTML_ATTR_NAME, HTML_TAG_NAME, HTTP_RESPONSE, IS_BROKEN, IS_INTERNAL, REBASED_URL, REDIRECTED_URL, WAS_EXCLUDED} from \"../internal/Link\";\nimport {getRobotsTxt, isCompatibleScheme as isHTTPScheme, transitiveAuth} from \"../internal/http-protocol\";\nimport HtmlUrlChecker from \"./HtmlUrlChecker\";\nimport parseOptions from \"../internal/parseOptions\";\nimport RequestQueue, {ITEM_EVENT, END_EVENT as REQUEST_QUEUE_END_EVENT} from \"limited-request-queue\";\nimport SafeEventEmitter from \"../internal/SafeEventEmitter\";\nimport URLCache from \"urlcache\";\n\n\n\n// @todo BLC_ROBOTS catches rel=nofollow links but will also catch meta/header excluded links -- fine?\nconst PAGE_EXCLUSIONS = [\"BLC_KEYWORD\", \"BLC_ROBOTS\"];\n\nconst PAGE_WAS_CHECKED = true;\n\n\n\nexport default class SiteChecker extends SafeEventEmitter\n{\n\t#currentAuth;\n\t#currentCustomData;\n\t#currentDone;\n\t#currentPageError;\n\t#currentRobotsTxt;\n\t#currentSiteURL;\n\t#htmlUrlChecker;\n\t#options;\n\t#sitePagesChecked;\n\t#siteUrlQueue;\n\n\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.#options = this.#overrideOptions(parseOptions(options)); // @todo https://github.com/tc39/proposal-pipeline-operator\n\t\tthis.#sitePagesChecked = new URLCache({ maxAge: this.#options.cacheMaxAge });\n\t\tthis.#reset();\n\n\t\tthis.#siteUrlQueue = new RequestQueue(\n\t\t{\n\t\t\tmaxSockets: 1,\n\t\t\trateLimit: this.#options.rateLimit\n\t\t})\n\t\t.on(ITEM_EVENT, async (url, {auth, customData}, done) =>\n\t\t{\n\t\t\tthis.#reset();\n\n\t\t\tthis.#currentAuth = auth;\n\t\t\tthis.#currentCustomData = customData;\n\t\t\tthis.#currentDone = done;\n\t\t\tthis.#currentSiteURL = url;  // @todo strip after hostname?\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (isHTTPScheme(url) && this.#options.honorRobotExclusions)\n\t\t\t\t{\n\t\t\t\t\tconst robots = await getRobotsTxt(this.#currentSiteURL, this.#currentAuth, this.__cache, this.#options);\n\n\t\t\t\t\t// This receives an instance even if no robots.txt was found\n\t\t\t\t\tthis.#currentRobotsTxt = robots;\n\n\t\t\t\t\tthis.emit(ROBOTS_EVENT, robots, this.#currentCustomData);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\t// If could not connect to server -- let `HtmlUrlChecker` catch it\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.#enqueuePage(this.#currentSiteURL, this.#currentCustomData, this.#currentAuth);\n\t\t\t}\n\t\t})\n\t\t.on(REQUEST_QUEUE_END_EVENT, () =>\n\t\t{\n\t\t\t// Clear references for garbage collection\n\t\t\tthis.#reset();\n\n\t\t\tthis.emit(END_EVENT);\n\t\t});\n\n\t\tthis.#htmlUrlChecker = new HtmlUrlChecker(this.#options)\n\t\t.on(ERROR_EVENT, error => this.emit(ERROR_EVENT, error))\n\t\t.on(HTML_EVENT, (tree, robots, response, pageURL, customData) =>\n\t\t{\n\t\t\t// If was redirected\n\t\t\tif (response.url !== pageURL)\n\t\t\t{\n\t\t\t\tthis.#sitePagesChecked.set(response.url, PAGE_WAS_CHECKED);\n\n\t\t\t\t// Avoid rechecking any redirected pages\n\t\t\t\tresponse.redirects.forEach(redirect => this.#sitePagesChecked.set(redirect.url, PAGE_WAS_CHECKED));\n\t\t\t}\n\n\t\t\tthis.emit(HTML_EVENT, tree, robots, response, pageURL, customData);\n\t\t})\n\t\t.on(QUEUE_EVENT, () => this.emit(QUEUE_EVENT))\n\t\t.on(JUNK_EVENT, (result, customData) =>\n\t\t{\n\t\t\tthis.emit(JUNK_EVENT, result, customData);\n\n\t\t\tthis.#maybeEnqueuePage(result, customData, this.#currentAuth);\n\t\t})\n\t\t.on(LINK_EVENT, (result, customData) =>\n\t\t{\n\t\t\tthis.emit(LINK_EVENT, result, customData);\n\n\t\t\tthis.#maybeEnqueuePage(result, customData, this.#currentAuth);\n\t\t})\n\t\t.on(PAGE_EVENT, (error, pageURL, customData) =>\n\t\t{\n\t\t\tthis.emit(PAGE_EVENT, error, pageURL, customData);\n\n\t\t\t// Only the first page should supply an error to SITE_EVENT\n\t\t\tif (this.#sitePagesChecked.length <= 1)\n\t\t\t{\n\t\t\t\tthis.#currentPageError = error;\n\t\t\t}\n\t\t})\n\t\t.on(END_EVENT, () =>\n\t\t{\n\t\t\tthis.emit(SITE_EVENT, this.#currentPageError, this.#currentSiteURL, this.#currentCustomData);\n\n\t\t\t// Auto-starts next site, if any\n\t\t\t// Emits REQUEST_QUEUE_END_EVENT, if not\n\t\t\tthis.#currentDone();\n\t\t});\n\t}\n\n\n\n\tclearCache()\n\t{\n\t\t// Does not clear `sitePagesChecked` because it would mess up any current scans\n\t\tthis.#htmlUrlChecker.clearCache();\n\t\treturn this;\n\t}\n\n\n\n\tdequeue(id)\n\t{\n\t\tconst success = this.#siteUrlQueue.dequeue(id);\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn success;\n\t}\n\n\n\n\tenqueue(firstPageURL, customData)\n\t{\n\t\tconst transitive = transitiveAuth(firstPageURL);\n\n\t\tconst success = this.#siteUrlQueue.enqueue(transitive.url, { auth:transitive.auth, customData });\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn success;\n\t}\n\n\n\n\t/**\n\t * Enqueue a URL to be crawled.\n\t * @param {URL} url\n\t * @param {*} customData\n\t * @param {object} auth\n\t */\n\t#enqueuePage(url, customData, auth)\n\t{\n\t\t// Avoid links to self within page\n\t\tthis.#sitePagesChecked.set(url, PAGE_WAS_CHECKED);\n\n\t\tthis.#htmlUrlChecker.enqueue(url, customData, auth);\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be excluded from checks, and the reason for such.\n\t * @param {Link} link\n\t * @returns {string|undefined}\n\t */\n\t#getExcludedReason(link)\n\t{\n\t\tif (link.get(IS_INTERNAL) && !this.#isAllowed(link))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Not excluded\n\t\t}\n\t}\n\n\n\n\thas(id)\n\t{\n\t\treturn this.#siteUrlQueue.has(id);\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be included, conforming to any robots filter.\n\t * @param {Link} link\n\t * @returns {boolean}\n\t */\n\t#isAllowed(link)\n\t{\n\t\tif (this.#options.honorRobotExclusions)\n\t\t{\n\t\t\tconst rebasedPathname = link.get(REBASED_URL)?.pathname;\n\n\t\t\t// @todo remove condition when/if `Link::invalidate()` is used in `HtmlChecker`\n\t\t\tif (rebasedPathname !== null)\n\t\t\t{\n\t\t\t\treturn this.#currentRobotsTxt.isAllowed(this.#options.userAgent, rebasedPathname);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t}\n\n\n\n\tget isPaused()\n\t{\n\t\treturn this.#htmlUrlChecker.isPaused;\n\t}\n\n\n\n\t/**\n\t * Enqueue a page (to be crawled) if it passes filters.\n\t * @param {Link} link\n\t * @param {*} customData\n\t * @param {object} auth\n\t */\n\t#maybeEnqueuePage(link, customData, auth)\n\t{\n\t\t// Skip specific links that were excluded from checks\n\t\tif (link.get(WAS_EXCLUDED) && PAGE_EXCLUSIONS.includes(link.get(EXCLUDED_REASON)))\n\t\t{\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst tagGroup = this.#options.tags.recursive[this.#options.filterLevel][link.get(HTML_TAG_NAME)] ?? {};\n\t\t\tconst attrSupported = link.get(HTML_ATTR_NAME) in tagGroup;\n\t\t\tconst rebasedURL = link.get(REBASED_URL);\n\t\t\tconst redirectedURL = link.get(REDIRECTED_URL);\n\n\t\t\tif (\n\t\t\t\t!attrSupported ||\n\t\t\t\tlink.get(IS_BROKEN) ||\n\t\t\t\t!link.get(IS_INTERNAL) ||\n\t\t\t\tthis.#sitePagesChecked.has(rebasedURL) ||\n\t\t\t\t!this.#isAllowed(link)\n\t\t\t   )\n\t\t\t{\n\t\t\t\t// do nothing\n\t\t\t}\n\t\t\telse if (redirectedURL !== null)\n\t\t\t{\n\t\t\t\t// Because only the final redirected page needs to be [recursively] checked,\n\t\t\t\t// all redirects are stored as pages that have been checked\n\t\t\t\tlink.get(HTTP_RESPONSE).redirects.forEach(({url}) => this.#sitePagesChecked.set(url, PAGE_WAS_CHECKED));\n\n\t\t\t\tif (!this.#sitePagesChecked.has(redirectedURL))\n\t\t\t\t{\n\t\t\t\t\tthis.#enqueuePage(redirectedURL, customData, auth);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#options.includePage(rebasedURL))\n\t\t\t{\n\t\t\t\tthis.#enqueuePage(rebasedURL, customData, auth);\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\tget numActiveLinks()\n\t{\n\t\treturn this.#htmlUrlChecker.numActiveLinks;\n\t}\n\n\n\n\tget numQueuedLinks()\n\t{\n\t\treturn this.#htmlUrlChecker.numQueuedLinks;\n\t}\n\n\n\n\tget numPages()\n\t{\n\t\treturn this.#htmlUrlChecker.numPages;\n\t}\n\n\n\n\tget numSites()\n\t{\n\t\treturn this.#siteUrlQueue.length;\n\t}\n\n\n\n\t/**\n\t * Override/mutate some options for extended behavior.\n\t * @param {object} options\n\t * @returns {object}\n\t */\n\t#overrideOptions(options)\n\t{\n\t\tconst {includeLink} = options;\n\n\t\toptions.includeLink = link =>\n\t\t{\n\t\t\tconst excludedReason = this.#getExcludedReason(link);\n\n\t\t\tif (excludedReason === undefined)\n\t\t\t{\n\t\t\t\treturn includeLink(link);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Undocumented return value type\n\t\t\t\treturn excludedReason;\n\t\t\t}\n\t\t};\n\n\t\treturn options;\n\t}\n\n\n\n\tpause()\n\t{\n\t\tthis.#htmlUrlChecker.pause();\n\t\tthis.#siteUrlQueue.pause();\n\t\treturn this;\n\t}\n\n\n\n\t#reset()\n\t{\n\t\tthis.#currentAuth = null;\n\t\tthis.#currentCustomData = null;\n\t\tthis.#currentDone = null;\n\t\tthis.#currentPageError = null;\n\t\tthis.#currentRobotsTxt = null;\n\t\tthis.#currentSiteURL = null;\n\t\tthis.#sitePagesChecked.clear();\n\t}\n\n\n\n\tresume()\n\t{\n\t\tthis.#htmlUrlChecker.resume();\n\t\tthis.#siteUrlQueue.resume();\n\t\treturn this;\n\t}\n\n\n\n\t// Useless, but consistent with other classes\n\tget __cache()\n\t{\n\t\treturn this.#htmlUrlChecker.__cache;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}