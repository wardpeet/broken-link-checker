{"version":3,"file":"HtmlChecker.js","names":["_events","require","_Link","_linkTypes","_parseHTML","_interopRequireDefault","_parseOptions","_robotDirectives","_interopRequireWildcard","_SafeEventEmitter","_scrapeHTML","_httpProtocol","_UrlChecker","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_classPrivateMethodInitSpec","_checkPrivateRedeclaration","add","_classPrivateFieldInitSpec","TypeError","_classPrivateFieldGet","s","_assertClassBrand","_classPrivateFieldSet","arguments","length","_auth","_excludedLinks","_options","_resolvePromise","_robots","_scanning","_urlChecker","_HtmlChecker_brand","WeakSet","HtmlChecker","SafeEventEmitter","constructor","options","parseOptions","_reset","UrlChecker","on","ERROR_EVENT","error","emit","QUEUE_EVENT","JUNK_EVENT","result","_this$excludedLinks","_this$excludedLinks2","HTML_OFFSET_INDEX","LINK_EVENT","END_EVENT","_complete","clearCache","isPaused","numActiveLinks","numQueuedLinks","pause","resume","scan","html","baseURL","robots","auth","Error","RobotDirectives","userAgent","transitive","transitiveAuth","url","document","parseHTML","links","scrapeHTML","HTML_EVENT","forEach","link","_maybeEnqueueLink","resolveOnComplete","Promise","resolve","__cache","exports","resolvePromise","COMPLETE_EVENT","_getExcludeReason","attrName","HTML_ATTR_NAME","attrs","HTML_ATTRS","isInternal","IS_INTERNAL","tagName","HTML_TAG_NAME","excludeExternalLinks","excludeInternalLinks","excludeLinksToSamePage","honorRobotExclusions","oneIs","NOFOLLOW","NOINDEX","is","NOIMAGEINDEX","isRobotAttr","rel","linkTypes","nofollow","_isExcludedAttribute","IS_SAME_PAGE","tagNames","tagGroups","tags","filterLevel","every","REBASED_URL","HTML_INDEX","break","excludedReason","undefined","enqueue","_this$excludedLinks3","_this$excludedLinks4","exclude","module"],"sources":["../../lib/public/HtmlChecker.js"],"sourcesContent":["import {COMPLETE_EVENT, END_EVENT, ERROR_EVENT, HTML_EVENT, JUNK_EVENT, LINK_EVENT, QUEUE_EVENT} from \"../internal/events\";\nimport {HTML_ATTR_NAME, HTML_ATTRS, HTML_INDEX, HTML_OFFSET_INDEX, HTML_TAG_NAME, IS_INTERNAL, IS_SAME_PAGE, REBASED_URL} from \"../internal/Link\";\nimport {map as linkTypes} from \"link-types\";\nimport parseHTML from \"../internal/parseHTML\";\nimport parseOptions from \"../internal/parseOptions\";\nimport RobotDirectives, {NOFOLLOW, NOIMAGEINDEX, NOINDEX} from \"robot-directives\";\nimport SafeEventEmitter from \"../internal/SafeEventEmitter\";\nimport scrapeHTML from \"../internal/scrapeHTML\";\nimport {transitiveAuth} from \"../internal/http-protocol\";\nimport UrlChecker from \"./UrlChecker\";\n\n\n\nexport default class HtmlChecker extends SafeEventEmitter\n{\n\t#auth;\n\t#excludedLinks;\n\t#options;\n\t#resolvePromise;\n\t#robots;\n\t#scanning;\n\t#urlChecker;\n\n\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.#options = parseOptions(options);\n\t\tthis.#reset();\n\n\t\tthis.#urlChecker = new UrlChecker(this.#options)\n\t\t.on(ERROR_EVENT, error => this.emit(ERROR_EVENT, error))\n\t\t.on(QUEUE_EVENT, () => this.emit(QUEUE_EVENT))\n\t\t.on(JUNK_EVENT, result =>\n\t\t{\n\t\t\tresult.set(HTML_OFFSET_INDEX, this.#excludedLinks++);\n\n\t\t\tthis.emit(JUNK_EVENT, result);\n\t\t})\n\t\t.on(LINK_EVENT, result => this.emit(LINK_EVENT, result))\n\t\t.on(END_EVENT, () => this.#complete());\n\t}\n\n\n\n\tclearCache()\n\t{\n\t\tthis.#urlChecker.clearCache();\n\t\treturn this;\n\t}\n\n\n\n\t#complete()\n\t{\n\t\tconst resolvePromise = this.#resolvePromise;\n\n\t\tthis.#reset();\n\n\t\tthis.emit(COMPLETE_EVENT);\n\n\t\tresolvePromise();\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be excluded from checks, and the reason for such.\n\t * @param {Link} link\n\t * @returns {string|undefined}\n\t */\n\t#getExcludeReason(link)\n\t{\n\t\tconst attrName = link.get(HTML_ATTR_NAME);\n\t\tconst attrs = link.get(HTML_ATTRS);\n\t\tconst isInternal = link.get(IS_INTERNAL);\n\t\tconst tagName = link.get(HTML_TAG_NAME);\n\n\t\tconst\n\t\t{\n\t\t\texcludeExternalLinks,\n\t\t\texcludeInternalLinks,\n\t\t\texcludeLinksToSamePage,\n\t\t\thonorRobotExclusions\n\t\t} = this.#options;\n\n\t\tif (honorRobotExclusions && this.#robots.oneIs([ NOFOLLOW, NOINDEX ]))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (honorRobotExclusions && this.#robots.is(NOIMAGEINDEX) && isRobotAttr(tagName, attrName))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (honorRobotExclusions && attrs?.rel!=null && linkTypes(attrs.rel).nofollow)\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (this.#isExcludedAttribute(attrName, [tagName, \"*\"]))\n\t\t{\n\t\t\treturn \"BLC_HTML\";\n\t\t}\n\t\telse if (excludeExternalLinks && isInternal===false)\n\t\t{\n\t\t\treturn \"BLC_EXTERNAL\";\n\t\t}\n\t\telse if (excludeInternalLinks && isInternal)\n\t\t{\n\t\t\treturn \"BLC_INTERNAL\";\n\t\t}\n\t\telse if (excludeLinksToSamePage && link.get(IS_SAME_PAGE))\n\t\t{\n\t\t\treturn \"BLC_SAMEPAGE\";\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link's HTML element and attribute would cause it to be excluded from checks.\n\t * @param {string} attrName\n\t * @param {Array<string>} tagNames\n\t * @returns {boolean}\n\t */\n\t#isExcludedAttribute(attrName, tagNames)\n\t{\n\t\tconst tagGroups = this.#options.tags[this.#options.filterLevel];\n\n\t\treturn tagNames.every(tagName => !(tagName in tagGroups) || !(attrName in tagGroups[tagName]));\n\t}\n\n\n\n\tget isPaused()\n\t{\n\t\treturn this.#urlChecker.isPaused;\n\t}\n\n\n\n\t/**\n\t * Enqueue a Link if it is valid and passes filters.\n\t * @param {Link} link\n\t */\n\t#maybeEnqueueLink(link)\n\t{\n\t\tif (link.get(REBASED_URL) === null)\n\t\t{\n\t\t\tlink.set(HTML_OFFSET_INDEX, link.get(HTML_INDEX) - this.#excludedLinks);\n\t\t\tlink.break(\"BLC_INVALID\");\n\n\t\t\t// Can't enqueue a non-URL\n\t\t\tthis.emit(LINK_EVENT, link);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst excludedReason = this.#getExcludeReason(link);\n\n\t\t\tif (excludedReason === undefined)\n\t\t\t{\n\t\t\t\tlink.set(HTML_OFFSET_INDEX, link.get(HTML_INDEX) - this.#excludedLinks);\n\n\t\t\t\tthis.#urlChecker.enqueue(link, null, this.#auth);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlink.set(HTML_OFFSET_INDEX, this.#excludedLinks++);\n\t\t\t\tlink.exclude(excludedReason);\n\n\t\t\t\tthis.emit(JUNK_EVENT, link);\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\tget numActiveLinks()\n\t{\n\t\treturn this.#urlChecker.numActiveLinks;\n\t}\n\n\n\n\tget numQueuedLinks()\n\t{\n\t\treturn this.#urlChecker.numQueuedLinks;\n\t}\n\n\n\n\tpause()\n\t{\n\t\tthis.#urlChecker.pause();\n\t\treturn this;\n\t}\n\n\n\n\t#reset()\n\t{\n\t\tthis.#auth = null;\n\t\tthis.#excludedLinks = 0;\n\t\tthis.#resolvePromise = null;\n\t\tthis.#robots = null;\n\t\tthis.#scanning = false;\n\t}\n\n\n\n\tresume()\n\t{\n\t\tthis.#urlChecker.resume();\n\t\treturn this;\n\t}\n\n\n\n\t// `robots` and `auth` are undocumented and for internal use only\n\tasync scan(html, baseURL, robots, auth)\n\t{\n\t\tif (this.#scanning)\n\t\t{\n\t\t\t// @todo use custom error (for better tests and consumer debugging) ?\n\t\t\tthrow new Error(\"Scan already in progress\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Prevent user error with missing undocumented arugment\n\t\t\tif (!(robots instanceof RobotDirectives))\n\t\t\t{\n\t\t\t\trobots = new RobotDirectives({ userAgent: this.#options.userAgent });\n\t\t\t}\n\n\t\t\tconst transitive = transitiveAuth(baseURL, auth);\n\n\t\t\tbaseURL = transitive.url;  // @todo remove hash (and store somewhere?)\n\n\t\t\tthis.#auth = transitive.auth;\n\t\t\tthis.#robots = robots;\n\t\t\tthis.#scanning = true;\n\n\t\t\tconst document = await parseHTML(html);\n\t\t\tconst links = scrapeHTML(document, baseURL, this.#robots);  // @todo add auth?\n\n\t\t\tthis.emit(HTML_EVENT, document, this.#robots);\n\n\t\t\tlinks.forEach(link => this.#maybeEnqueueLink(link));\n\n\t\t\tconst resolveOnComplete = new Promise(resolve => this.#resolvePromise = resolve);\n\n\t\t\t// If no links found or all links already checked\n\t\t\tif (this.#urlChecker.numActiveLinks===0 && this.#urlChecker.numQueuedLinks===0)\n\t\t\t{\n\t\t\t\tthis.#complete();\n\t\t\t}\n\n\t\t\treturn resolveOnComplete;\n\t\t}\n\t}\n\n\n\n\tget __cache()\n\t{\n\t\treturn this.#urlChecker.__cache;\n\t}\n}\n\n\n\n//::: PRIVATE FUNCTIONS\n\n\n\nconst isRobotAttr = (tagName, attrName) =>\n{\n\treturn (tagName===\"img\"      && attrName===\"src\"   ) ||\n\t       (tagName===\"input\"    && attrName===\"src\"   ) ||\n\t       (tagName===\"menuitem\" && attrName===\"icon\"  ) ||\n\t       (tagName===\"video\"    && attrName===\"poster\");\n};\n"],"mappings":"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","ignoreList":[]}